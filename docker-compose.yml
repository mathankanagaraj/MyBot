services:
  angel_bot:
    image: options_bot:latest
    build:
      context: .
      dockerfile: Dockerfile
    container_name: angel_bot
    env_file: .env
    environment:
      - TZ=Asia/Kolkata
      - BROKER=ANGEL
    volumes:
      - ./logs:/app/logs
      - ./audit:/app/audit
    restart: unless-stopped

  ibkr_bot:
    image: options_bot:latest
    # Build handled by angel_bot service to avoid race condition
    depends_on:
      - angel_bot
    container_name: ibkr_bot
    env_file: .env
    environment:
      - TZ=America/New_York
      - BROKER=IBKR
      - IB_HOST=host.docker.internal
    volumes:
      - ./logs:/app/logs
      - ./audit:/app/audit
    restart: unless-stopped
